{"format_version":"1.2","terraform_version":"1.10.7","variables":{"LOG":{"value":"Debug"},"aws_region":{"value":"us-east-1"},"enable_versioning":{"value":true},"environment":{"value":"dev"},"kms_key_alias":{"value":"alias/s3-logs-encryption-key"},"lifecycle_expiration_days":{"value":30},"lifecycle_transition_days":{"value":7},"public_access_prefix":{"value":"public/"},"s3_bucket_name":{"value":"logs-backup-storage-dev"}},"planned_values":{"outputs":{"access_logs_bucket_arn":{"sensitive":false},"access_logs_bucket_id":{"sensitive":false},"cloudwatch_dashboard_name":{"sensitive":false,"type":"string","value":"s3-logs-backup-dev"},"iam_policy_read_only_arn":{"sensitive":false},"iam_policy_read_write_arn":{"sensitive":false},"kms_key_alias":{"sensitive":false,"type":"string","value":"alias/s3-logs-encryption-key-dev"},"kms_key_arn":{"sensitive":false},"kms_key_id":{"sensitive":false},"main_bucket_arn":{"sensitive":false},"main_bucket_domain_name":{"sensitive":false},"main_bucket_id":{"sensitive":false},"main_bucket_regional_domain_name":{"sensitive":false},"sns_topic_arn":{"sensitive":false}},"root_module":{"resources":[{"address":"aws_cloudwatch_dashboard.s3_monitoring","mode":"managed","type":"aws_cloudwatch_dashboard","name":"s3_monitoring","provider_name":"registry.opentofu.org/hashicorp/aws","schema_version":0,"values":{"dashboard_body":"{\"widgets\":[{\"properties\":{\"metrics\":[[\"AWS/S3\",\"BucketSizeBytes\",{\"label\":\"Bucket Size\",\"stat\":\"Average\"}]],\"period\":86400,\"region\":\"us-east-1\",\"stat\":\"Average\",\"title\":\"S3 Bucket Size\",\"yAxis\":{\"left\":{\"label\":\"Bytes\"}}},\"type\":\"metric\"},{\"properties\":{\"metrics\":[[\"AWS/S3\",\"NumberOfObjects\",{\"label\":\"Object Count\",\"stat\":\"Average\"}]],\"period\":86400,\"region\":\"us-east-1\",\"stat\":\"Average\",\"title\":\"S3 Object Count\"},\"type\":\"metric\"},{\"properties\":{\"metrics\":[[\"AWS/S3\",\"AllRequests\",{\"label\":\"Total Requests\",\"stat\":\"Sum\"}],[\".\",\"GetRequests\",{\"label\":\"GET Requests\",\"stat\":\"Sum\"}],[\".\",\"PutRequests\",{\"label\":\"PUT Requests\",\"stat\":\"Sum\"}],[\".\",\"DeleteRequests\",{\"label\":\"DELETE Requests\",\"stat\":\"Sum\"}],[\".\",\"HeadRequests\",{\"label\":\"HEAD Requests\",\"stat\":\"Sum\"}]],\"period\":300,\"region\":\"us-east-1\",\"stat\":\"Sum\",\"title\":\"S3 Request Metrics\"},\"type\":\"metric\"},{\"properties\":{\"metrics\":[[\"AWS/S3\",\"4xxErrors\",{\"label\":\"4xx Errors\",\"stat\":\"Sum\"}],[\".\",\"5xxErrors\",{\"label\":\"5xx Errors\",\"stat\":\"Sum\"}]],\"period\":300,\"region\":\"us-east-1\",\"stat\":\"Sum\",\"title\":\"S3 Error Metrics\",\"yAxis\":{\"left\":{\"min\":0}}},\"type\":\"metric\"}]}","dashboard_name":"s3-logs-backup-dev"},"sensitive_values":{}},{"address":"aws_cloudwatch_metric_alarm.bucket_4xx_errors","mode":"managed","type":"aws_cloudwatch_metric_alarm","name":"bucket_4xx_errors","provider_name":"registry.opentofu.org/hashicorp/aws","schema_version":1,"values":{"actions_enabled":true,"alarm_description":"Alert when S3 bucket 4xx errors exceed threshold","alarm_name":"s3-logs-backup-storage-dev-dev-4xx-errors-high","comparison_operator":"GreaterThanThreshold","datapoints_to_alarm":null,"evaluation_periods":2,"extended_statistic":null,"insufficient_data_actions":null,"metric_name":"4xxErrors","metric_query":[],"namespace":"AWS/S3","ok_actions":null,"period":300,"statistic":"Sum","tags":{"Environment":"dev","Name":"s3-logs-backup-storage-dev-dev-4xx-errors-high","Purpose":"LogsAndBackups","Service":"S3Storage"},"tags_all":{"Environment":"dev","ManagedBy":"OpenTofu","Name":"s3-logs-backup-storage-dev-dev-4xx-errors-high","Project":"S3LogsBackup","Purpose":"LogsAndBackups","Service":"S3Storage"},"threshold":10,"threshold_metric_id":null,"treat_missing_data":"notBreaching","unit":null},"sensitive_values":{"alarm_actions":[],"dimensions":{},"metric_query":[],"tags":{},"tags_all":{}}},{"address":"aws_cloudwatch_metric_alarm.bucket_5xx_errors","mode":"managed","type":"aws_cloudwatch_metric_alarm","name":"bucket_5xx_errors","provider_name":"registry.opentofu.org/hashicorp/aws","schema_version":1,"values":{"actions_enabled":true,"alarm_description":"Alert when S3 bucket 5xx errors exceed threshold","alarm_name":"s3-logs-backup-storage-dev-dev-5xx-errors-high","comparison_operator":"GreaterThanThreshold","datapoints_to_alarm":null,"evaluation_periods":1,"extended_statistic":null,"insufficient_data_actions":null,"metric_name":"5xxErrors","metric_query":[],"namespace":"AWS/S3","ok_actions":null,"period":300,"statistic":"Sum","tags":{"Environment":"dev","Name":"s3-logs-backup-storage-dev-dev-5xx-errors-high","Purpose":"LogsAndBackups","Service":"S3Storage"},"tags_all":{"Environment":"dev","ManagedBy":"OpenTofu","Name":"s3-logs-backup-storage-dev-dev-5xx-errors-high","Project":"S3LogsBackup","Purpose":"LogsAndBackups","Service":"S3Storage"},"threshold":5,"threshold_metric_id":null,"treat_missing_data":"notBreaching","unit":null},"sensitive_values":{"alarm_actions":[],"dimensions":{},"metric_query":[],"tags":{},"tags_all":{}}},{"address":"aws_cloudwatch_metric_alarm.bucket_size","mode":"managed","type":"aws_cloudwatch_metric_alarm","name":"bucket_size","provider_name":"registry.opentofu.org/hashicorp/aws","schema_version":1,"values":{"actions_enabled":true,"alarm_description":"Alert when S3 bucket size exceeds 100GB","alarm_name":"s3-logs-backup-storage-dev-dev-size-high","comparison_operator":"GreaterThanThreshold","datapoints_to_alarm":null,"evaluation_periods":1,"extended_statistic":null,"insufficient_data_actions":null,"metric_name":"BucketSizeBytes","metric_query":[],"namespace":"AWS/S3","ok_actions":null,"period":86400,"statistic":"Average","tags":{"Environment":"dev","Name":"s3-logs-backup-storage-dev-dev-size-high","Purpose":"LogsAndBackups","Service":"S3Storage"},"tags_all":{"Environment":"dev","ManagedBy":"OpenTofu","Name":"s3-logs-backup-storage-dev-dev-size-high","Project":"S3LogsBackup","Purpose":"LogsAndBackups","Service":"S3Storage"},"threshold":107374182400,"threshold_metric_id":null,"treat_missing_data":"notBreaching","unit":null},"sensitive_values":{"alarm_actions":[],"dimensions":{},"metric_query":[],"tags":{},"tags_all":{}}},{"address":"aws_cloudwatch_metric_alarm.number_of_objects","mode":"managed","type":"aws_cloudwatch_metric_alarm","name":"number_of_objects","provider_name":"registry.opentofu.org/hashicorp/aws","schema_version":1,"values":{"actions_enabled":true,"alarm_description":"Alert when S3 bucket object count exceeds 100,000","alarm_name":"s3-logs-backup-storage-dev-dev-object-count-high","comparison_operator":"GreaterThanThreshold","datapoints_to_alarm":null,"evaluation_periods":1,"extended_statistic":null,"insufficient_data_actions":null,"metric_name":"NumberOfObjects","metric_query":[],"namespace":"AWS/S3","ok_actions":null,"period":86400,"statistic":"Average","tags":{"Environment":"dev","Name":"s3-logs-backup-storage-dev-dev-object-count-high","Purpose":"LogsAndBackups","Service":"S3Storage"},"tags_all":{"Environment":"dev","ManagedBy":"OpenTofu","Name":"s3-logs-backup-storage-dev-dev-object-count-high","Project":"S3LogsBackup","Purpose":"LogsAndBackups","Service":"S3Storage"},"threshold":100000,"threshold_metric_id":null,"treat_missing_data":"notBreaching","unit":null},"sensitive_values":{"alarm_actions":[],"dimensions":{},"metric_query":[],"tags":{},"tags_all":{}}},{"address":"aws_iam_policy.s3_read_only","mode":"managed","type":"aws_iam_policy","name":"s3_read_only","provider_name":"registry.opentofu.org/hashicorp/aws","schema_version":0,"values":{"description":"IAM policy for read-only access to S3 logs backup bucket - dev","name":"s3-logs-backup-read-only-dev","path":"/","tags":{"Environment":"dev","Name":"s3-logs-backup-read-only-dev","Purpose":"LogsAndBackups","Service":"S3Storage"},"tags_all":{"Environment":"dev","ManagedBy":"OpenTofu","Name":"s3-logs-backup-read-only-dev","Project":"S3LogsBackup","Purpose":"LogsAndBackups","Service":"S3Storage"}},"sensitive_values":{"tags":{},"tags_all":{}}},{"address":"aws_iam_policy.s3_read_write","mode":"managed","type":"aws_iam_policy","name":"s3_read_write","provider_name":"registry.opentofu.org/hashicorp/aws","schema_version":0,"values":{"description":"IAM policy for read/write access to S3 logs backup bucket - dev","name":"s3-logs-backup-read-write-dev","path":"/","tags":{"Environment":"dev","Name":"s3-logs-backup-read-write-dev","Purpose":"LogsAndBackups","Service":"S3Storage"},"tags_all":{"Environment":"dev","ManagedBy":"OpenTofu","Name":"s3-logs-backup-read-write-dev","Project":"S3LogsBackup","Purpose":"LogsAndBackups","Service":"S3Storage"}},"sensitive_values":{"tags":{},"tags_all":{}}},{"address":"aws_kms_alias.s3_encryption","mode":"managed","type":"aws_kms_alias","name":"s3_encryption","provider_name":"registry.opentofu.org/hashicorp/aws","schema_version":0,"values":{"name":"alias/s3-logs-encryption-key-dev"},"sensitive_values":{}},{"address":"aws_kms_key.s3_encryption","mode":"managed","type":"aws_kms_key","name":"s3_encryption","provider_name":"registry.opentofu.org/hashicorp/aws","schema_version":0,"values":{"bypass_policy_lockout_safety_check":false,"custom_key_store_id":null,"customer_master_key_spec":"SYMMETRIC_DEFAULT","deletion_window_in_days":30,"description":"KMS key for S3 bucket encryption - dev","enable_key_rotation":true,"is_enabled":true,"key_usage":"ENCRYPT_DECRYPT","tags":{"Environment":"dev","Name":"s3-logs-encryption-key-dev","Purpose":"LogsAndBackups","Service":"S3Storage"},"tags_all":{"Environment":"dev","ManagedBy":"OpenTofu","Name":"s3-logs-encryption-key-dev","Project":"S3LogsBackup","Purpose":"LogsAndBackups","Service":"S3Storage"},"timeouts":null,"xks_key_id":null},"sensitive_values":{"tags":{},"tags_all":{}}},{"address":"aws_kms_key_policy.s3_encryption","mode":"managed","type":"aws_kms_key_policy","name":"s3_encryption","provider_name":"registry.opentofu.org/hashicorp/aws","schema_version":0,"values":{"bypass_policy_lockout_safety_check":false,"policy":"{\"Statement\":[{\"Action\":\"kms:*\",\"Effect\":\"Allow\",\"Principal\":{\"AWS\":\"arn:aws:iam::245764575680:root\"},\"Resource\":\"*\",\"Sid\":\"Enable IAM User Permissions\"},{\"Action\":[\"kms:Decrypt\",\"kms:GenerateDataKey\",\"kms:DescribeKey\"],\"Condition\":{\"StringEquals\":{\"kms:ViaService\":\"s3.us-east-1.amazonaws.com\"}},\"Effect\":\"Allow\",\"Principal\":{\"Service\":\"s3.amazonaws.com\"},\"Resource\":\"*\",\"Sid\":\"Allow S3 to use the key\"},{\"Action\":[\"kms:Decrypt\",\"kms:GenerateDataKey\"],\"Effect\":\"Allow\",\"Principal\":{\"Service\":\"cloudwatch.amazonaws.com\"},\"Resource\":\"*\",\"Sid\":\"Allow CloudWatch to use the key\"}],\"Version\":\"2012-10-17\"}"},"sensitive_values":{}},{"address":"aws_s3_bucket.access_logs","mode":"managed","type":"aws_s3_bucket","name":"access_logs","provider_name":"registry.opentofu.org/hashicorp/aws","schema_version":0,"values":{"bucket":"logs-backup-storage-dev-dev-access-logs","force_destroy":false,"tags":{"Environment":"dev","Name":"logs-backup-storage-dev-dev-access-logs","Purpose":"LogsAndBackups","Service":"S3Storage","Type":"AccessLogs"},"tags_all":{"Environment":"dev","ManagedBy":"OpenTofu","Name":"logs-backup-storage-dev-dev-access-logs","Project":"S3LogsBackup","Purpose":"LogsAndBackups","Service":"S3Storage","Type":"AccessLogs"},"timeouts":null},"sensitive_values":{"cors_rule":[],"grant":[],"lifecycle_rule":[],"logging":[],"object_lock_configuration":[],"replication_configuration":[],"server_side_encryption_configuration":[],"tags":{},"tags_all":{},"versioning":[],"website":[]}},{"address":"aws_s3_bucket.main","mode":"managed","type":"aws_s3_bucket","name":"main","provider_name":"registry.opentofu.org/hashicorp/aws","schema_version":0,"values":{"bucket":"logs-backup-storage-dev-dev","force_destroy":false,"tags":{"Environment":"dev","Name":"logs-backup-storage-dev-dev","Purpose":"LogsAndBackups","Service":"S3Storage","Type":"MainStorage"},"tags_all":{"Environment":"dev","ManagedBy":"OpenTofu","Name":"logs-backup-storage-dev-dev","Project":"S3LogsBackup","Purpose":"LogsAndBackups","Service":"S3Storage","Type":"MainStorage"},"timeouts":null},"sensitive_values":{"cors_rule":[],"grant":[],"lifecycle_rule":[],"logging":[],"object_lock_configuration":[],"replication_configuration":[],"server_side_encryption_configuration":[],"tags":{},"tags_all":{},"versioning":[],"website":[]}},{"address":"aws_s3_bucket_acl.access_logs","mode":"managed","type":"aws_s3_bucket_acl","name":"access_logs","provider_name":"registry.opentofu.org/hashicorp/aws","schema_version":0,"values":{"acl":"log-delivery-write","expected_bucket_owner":null},"sensitive_values":{"access_control_policy":[]}},{"address":"aws_s3_bucket_lifecycle_configuration.access_logs","mode":"managed","type":"aws_s3_bucket_lifecycle_configuration","name":"access_logs","provider_name":"registry.opentofu.org/hashicorp/aws","schema_version":1,"values":{"rule":[{"abort_incomplete_multipart_upload":[],"expiration":[{"date":null,"days":30,"expired_object_delete_marker":false}],"filter":[],"id":"delete-old-access-logs","noncurrent_version_expiration":[],"noncurrent_version_transition":[],"prefix":"","status":"Enabled","transition":[]}],"timeouts":null,"transition_default_minimum_object_size":"all_storage_classes_128K"},"sensitive_values":{"rule":[{"abort_incomplete_multipart_upload":[],"expiration":[{}],"filter":[],"noncurrent_version_expiration":[],"noncurrent_version_transition":[],"transition":[]}]}},{"address":"aws_s3_bucket_lifecycle_configuration.main","mode":"managed","type":"aws_s3_bucket_lifecycle_configuration","name":"main","provider_name":"registry.opentofu.org/hashicorp/aws","schema_version":1,"values":{"rule":[{"abort_incomplete_multipart_upload":[],"expiration":[{"date":null,"days":30,"expired_object_delete_marker":false}],"filter":[],"id":"transition-and-expire-objects","noncurrent_version_expiration":[{"newer_noncurrent_versions":null,"noncurrent_days":30}],"noncurrent_version_transition":[{"newer_noncurrent_versions":null,"noncurrent_days":7,"storage_class":"GLACIER"}],"prefix":"","status":"Enabled","transition":[{"date":null,"days":7,"storage_class":"GLACIER"}]},{"abort_incomplete_multipart_upload":[{"days_after_initiation":7}],"expiration":[],"filter":[],"id":"abort-incomplete-multipart-uploads","noncurrent_version_expiration":[],"noncurrent_version_transition":[],"prefix":"","status":"Enabled","transition":[]}],"timeouts":null,"transition_default_minimum_object_size":"all_storage_classes_128K"},"sensitive_values":{"rule":[{"abort_incomplete_multipart_upload":[],"expiration":[{}],"filter":[],"noncurrent_version_expiration":[{}],"noncurrent_version_transition":[{}],"transition":[{}]},{"abort_incomplete_multipart_upload":[{}],"expiration":[],"filter":[],"noncurrent_version_expiration":[],"noncurrent_version_transition":[],"transition":[]}]}},{"address":"aws_s3_bucket_logging.main","mode":"managed","type":"aws_s3_bucket_logging","name":"main","provider_name":"registry.opentofu.org/hashicorp/aws","schema_version":0,"values":{"expected_bucket_owner":null,"target_grant":[],"target_object_key_format":[],"target_prefix":"s3-access-logs/"},"sensitive_values":{"target_grant":[],"target_object_key_format":[]}},{"address":"aws_s3_bucket_metric.main","mode":"managed","type":"aws_s3_bucket_metric","name":"main","provider_name":"registry.opentofu.org/hashicorp/aws","schema_version":0,"values":{"filter":[],"name":"EntireBucket"},"sensitive_values":{"filter":[]}},{"address":"aws_s3_bucket_metric.public_prefix","mode":"managed","type":"aws_s3_bucket_metric","name":"public_prefix","provider_name":"registry.opentofu.org/hashicorp/aws","schema_version":0,"values":{"filter":[{"access_point":null,"prefix":"public/","tags":null}],"name":"PublicPrefixMetrics"},"sensitive_values":{"filter":[{}]}},{"address":"aws_s3_bucket_ownership_controls.access_logs","mode":"managed","type":"aws_s3_bucket_ownership_controls","name":"access_logs","provider_name":"registry.opentofu.org/hashicorp/aws","schema_version":0,"values":{"rule":[{"object_ownership":"BucketOwnerPreferred"}]},"sensitive_values":{"rule":[{}]}},{"address":"aws_s3_bucket_policy.main","mode":"managed","type":"aws_s3_bucket_policy","name":"main","provider_name":"registry.opentofu.org/hashicorp/aws","schema_version":0,"sensitive_values":{}},{"address":"aws_s3_bucket_public_access_block.access_logs","mode":"managed","type":"aws_s3_bucket_public_access_block","name":"access_logs","provider_name":"registry.opentofu.org/hashicorp/aws","schema_version":0,"values":{"block_public_acls":true,"block_public_policy":true,"ignore_public_acls":true,"restrict_public_buckets":true},"sensitive_values":{}},{"address":"aws_s3_bucket_public_access_block.main","mode":"managed","type":"aws_s3_bucket_public_access_block","name":"main","provider_name":"registry.opentofu.org/hashicorp/aws","schema_version":0,"values":{"block_public_acls":true,"block_public_policy":false,"ignore_public_acls":true,"restrict_public_buckets":false},"sensitive_values":{}},{"address":"aws_s3_bucket_server_side_encryption_configuration.access_logs","mode":"managed","type":"aws_s3_bucket_server_side_encryption_configuration","name":"access_logs","provider_name":"registry.opentofu.org/hashicorp/aws","schema_version":0,"values":{"expected_bucket_owner":null,"rule":[{"apply_server_side_encryption_by_default":[{"kms_master_key_id":"","sse_algorithm":"AES256"}],"bucket_key_enabled":null}]},"sensitive_values":{"rule":[{"apply_server_side_encryption_by_default":[{}]}]}},{"address":"aws_s3_bucket_server_side_encryption_configuration.main","mode":"managed","type":"aws_s3_bucket_server_side_encryption_configuration","name":"main","provider_name":"registry.opentofu.org/hashicorp/aws","schema_version":0,"values":{"expected_bucket_owner":null,"rule":[{"apply_server_side_encryption_by_default":[{"sse_algorithm":"aws:kms"}],"bucket_key_enabled":true}]},"sensitive_values":{"rule":[{"apply_server_side_encryption_by_default":[{}]}]}},{"address":"aws_s3_bucket_versioning.main","mode":"managed","type":"aws_s3_bucket_versioning","name":"main","provider_name":"registry.opentofu.org/hashicorp/aws","schema_version":0,"values":{"expected_bucket_owner":null,"mfa":null,"versioning_configuration":[{"status":"Enabled"}]},"sensitive_values":{"versioning_configuration":[{}]}},{"address":"aws_sns_topic.s3_alerts","mode":"managed","type":"aws_sns_topic","name":"s3_alerts","provider_name":"registry.opentofu.org/hashicorp/aws","schema_version":0,"values":{"application_failure_feedback_role_arn":null,"application_success_feedback_role_arn":null,"application_success_feedback_sample_rate":null,"archive_policy":null,"content_based_deduplication":false,"delivery_policy":null,"display_name":"S3 Logs Backup Alerts - dev","fifo_topic":false,"firehose_failure_feedback_role_arn":null,"firehose_success_feedback_role_arn":null,"firehose_success_feedback_sample_rate":null,"http_failure_feedback_role_arn":null,"http_success_feedback_role_arn":null,"http_success_feedback_sample_rate":null,"lambda_failure_feedback_role_arn":null,"lambda_success_feedback_role_arn":null,"lambda_success_feedback_sample_rate":null,"name":"s3-logs-backup-alerts-dev","sqs_failure_feedback_role_arn":null,"sqs_success_feedback_role_arn":null,"sqs_success_feedback_sample_rate":null,"tags":{"Environment":"dev","Name":"s3-logs-backup-alerts-dev","Purpose":"LogsAndBackups","Service":"S3Storage"},"tags_all":{"Environment":"dev","ManagedBy":"OpenTofu","Name":"s3-logs-backup-alerts-dev","Project":"S3LogsBackup","Purpose":"LogsAndBackups","Service":"S3Storage"}},"sensitive_values":{"tags":{},"tags_all":{}}}]}},"resource_changes":[{"address":"aws_cloudwatch_dashboard.s3_monitoring","mode":"managed","type":"aws_cloudwatch_dashboard","name":"s3_monitoring","provider_name":"registry.opentofu.org/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"dashboard_body":"{\"widgets\":[{\"properties\":{\"metrics\":[[\"AWS/S3\",\"BucketSizeBytes\",{\"label\":\"Bucket Size\",\"stat\":\"Average\"}]],\"period\":86400,\"region\":\"us-east-1\",\"stat\":\"Average\",\"title\":\"S3 Bucket Size\",\"yAxis\":{\"left\":{\"label\":\"Bytes\"}}},\"type\":\"metric\"},{\"properties\":{\"metrics\":[[\"AWS/S3\",\"NumberOfObjects\",{\"label\":\"Object Count\",\"stat\":\"Average\"}]],\"period\":86400,\"region\":\"us-east-1\",\"stat\":\"Average\",\"title\":\"S3 Object Count\"},\"type\":\"metric\"},{\"properties\":{\"metrics\":[[\"AWS/S3\",\"AllRequests\",{\"label\":\"Total Requests\",\"stat\":\"Sum\"}],[\".\",\"GetRequests\",{\"label\":\"GET Requests\",\"stat\":\"Sum\"}],[\".\",\"PutRequests\",{\"label\":\"PUT Requests\",\"stat\":\"Sum\"}],[\".\",\"DeleteRequests\",{\"label\":\"DELETE Requests\",\"stat\":\"Sum\"}],[\".\",\"HeadRequests\",{\"label\":\"HEAD Requests\",\"stat\":\"Sum\"}]],\"period\":300,\"region\":\"us-east-1\",\"stat\":\"Sum\",\"title\":\"S3 Request Metrics\"},\"type\":\"metric\"},{\"properties\":{\"metrics\":[[\"AWS/S3\",\"4xxErrors\",{\"label\":\"4xx Errors\",\"stat\":\"Sum\"}],[\".\",\"5xxErrors\",{\"label\":\"5xx Errors\",\"stat\":\"Sum\"}]],\"period\":300,\"region\":\"us-east-1\",\"stat\":\"Sum\",\"title\":\"S3 Error Metrics\",\"yAxis\":{\"left\":{\"min\":0}}},\"type\":\"metric\"}]}","dashboard_name":"s3-logs-backup-dev"},"after_unknown":{"dashboard_arn":true,"id":true},"before_sensitive":false,"after_sensitive":{}}},{"address":"aws_cloudwatch_metric_alarm.bucket_4xx_errors","mode":"managed","type":"aws_cloudwatch_metric_alarm","name":"bucket_4xx_errors","provider_name":"registry.opentofu.org/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"actions_enabled":true,"alarm_description":"Alert when S3 bucket 4xx errors exceed threshold","alarm_name":"s3-logs-backup-storage-dev-dev-4xx-errors-high","comparison_operator":"GreaterThanThreshold","datapoints_to_alarm":null,"evaluation_periods":2,"extended_statistic":null,"insufficient_data_actions":null,"metric_name":"4xxErrors","metric_query":[],"namespace":"AWS/S3","ok_actions":null,"period":300,"statistic":"Sum","tags":{"Environment":"dev","Name":"s3-logs-backup-storage-dev-dev-4xx-errors-high","Purpose":"LogsAndBackups","Service":"S3Storage"},"tags_all":{"Environment":"dev","ManagedBy":"OpenTofu","Name":"s3-logs-backup-storage-dev-dev-4xx-errors-high","Project":"S3LogsBackup","Purpose":"LogsAndBackups","Service":"S3Storage"},"threshold":10,"threshold_metric_id":null,"treat_missing_data":"notBreaching","unit":null},"after_unknown":{"alarm_actions":true,"arn":true,"dimensions":true,"evaluate_low_sample_count_percentiles":true,"id":true,"metric_query":[],"tags":{},"tags_all":{}},"before_sensitive":false,"after_sensitive":{"alarm_actions":[],"dimensions":{},"metric_query":[],"tags":{},"tags_all":{}}}},{"address":"aws_cloudwatch_metric_alarm.bucket_5xx_errors","mode":"managed","type":"aws_cloudwatch_metric_alarm","name":"bucket_5xx_errors","provider_name":"registry.opentofu.org/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"actions_enabled":true,"alarm_description":"Alert when S3 bucket 5xx errors exceed threshold","alarm_name":"s3-logs-backup-storage-dev-dev-5xx-errors-high","comparison_operator":"GreaterThanThreshold","datapoints_to_alarm":null,"evaluation_periods":1,"extended_statistic":null,"insufficient_data_actions":null,"metric_name":"5xxErrors","metric_query":[],"namespace":"AWS/S3","ok_actions":null,"period":300,"statistic":"Sum","tags":{"Environment":"dev","Name":"s3-logs-backup-storage-dev-dev-5xx-errors-high","Purpose":"LogsAndBackups","Service":"S3Storage"},"tags_all":{"Environment":"dev","ManagedBy":"OpenTofu","Name":"s3-logs-backup-storage-dev-dev-5xx-errors-high","Project":"S3LogsBackup","Purpose":"LogsAndBackups","Service":"S3Storage"},"threshold":5,"threshold_metric_id":null,"treat_missing_data":"notBreaching","unit":null},"after_unknown":{"alarm_actions":true,"arn":true,"dimensions":true,"evaluate_low_sample_count_percentiles":true,"id":true,"metric_query":[],"tags":{},"tags_all":{}},"before_sensitive":false,"after_sensitive":{"alarm_actions":[],"dimensions":{},"metric_query":[],"tags":{},"tags_all":{}}}},{"address":"aws_cloudwatch_metric_alarm.bucket_size","mode":"managed","type":"aws_cloudwatch_metric_alarm","name":"bucket_size","provider_name":"registry.opentofu.org/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"actions_enabled":true,"alarm_description":"Alert when S3 bucket size exceeds 100GB","alarm_name":"s3-logs-backup-storage-dev-dev-size-high","comparison_operator":"GreaterThanThreshold","datapoints_to_alarm":null,"evaluation_periods":1,"extended_statistic":null,"insufficient_data_actions":null,"metric_name":"BucketSizeBytes","metric_query":[],"namespace":"AWS/S3","ok_actions":null,"period":86400,"statistic":"Average","tags":{"Environment":"dev","Name":"s3-logs-backup-storage-dev-dev-size-high","Purpose":"LogsAndBackups","Service":"S3Storage"},"tags_all":{"Environment":"dev","ManagedBy":"OpenTofu","Name":"s3-logs-backup-storage-dev-dev-size-high","Project":"S3LogsBackup","Purpose":"LogsAndBackups","Service":"S3Storage"},"threshold":107374182400,"threshold_metric_id":null,"treat_missing_data":"notBreaching","unit":null},"after_unknown":{"alarm_actions":true,"arn":true,"dimensions":true,"evaluate_low_sample_count_percentiles":true,"id":true,"metric_query":[],"tags":{},"tags_all":{}},"before_sensitive":false,"after_sensitive":{"alarm_actions":[],"dimensions":{},"metric_query":[],"tags":{},"tags_all":{}}}},{"address":"aws_cloudwatch_metric_alarm.number_of_objects","mode":"managed","type":"aws_cloudwatch_metric_alarm","name":"number_of_objects","provider_name":"registry.opentofu.org/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"actions_enabled":true,"alarm_description":"Alert when S3 bucket object count exceeds 100,000","alarm_name":"s3-logs-backup-storage-dev-dev-object-count-high","comparison_operator":"GreaterThanThreshold","datapoints_to_alarm":null,"evaluation_periods":1,"extended_statistic":null,"insufficient_data_actions":null,"metric_name":"NumberOfObjects","metric_query":[],"namespace":"AWS/S3","ok_actions":null,"period":86400,"statistic":"Average","tags":{"Environment":"dev","Name":"s3-logs-backup-storage-dev-dev-object-count-high","Purpose":"LogsAndBackups","Service":"S3Storage"},"tags_all":{"Environment":"dev","ManagedBy":"OpenTofu","Name":"s3-logs-backup-storage-dev-dev-object-count-high","Project":"S3LogsBackup","Purpose":"LogsAndBackups","Service":"S3Storage"},"threshold":100000,"threshold_metric_id":null,"treat_missing_data":"notBreaching","unit":null},"after_unknown":{"alarm_actions":true,"arn":true,"dimensions":true,"evaluate_low_sample_count_percentiles":true,"id":true,"metric_query":[],"tags":{},"tags_all":{}},"before_sensitive":false,"after_sensitive":{"alarm_actions":[],"dimensions":{},"metric_query":[],"tags":{},"tags_all":{}}}},{"address":"aws_iam_policy.s3_read_only","mode":"managed","type":"aws_iam_policy","name":"s3_read_only","provider_name":"registry.opentofu.org/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"description":"IAM policy for read-only access to S3 logs backup bucket - dev","name":"s3-logs-backup-read-only-dev","path":"/","tags":{"Environment":"dev","Name":"s3-logs-backup-read-only-dev","Purpose":"LogsAndBackups","Service":"S3Storage"},"tags_all":{"Environment":"dev","ManagedBy":"OpenTofu","Name":"s3-logs-backup-read-only-dev","Project":"S3LogsBackup","Purpose":"LogsAndBackups","Service":"S3Storage"}},"after_unknown":{"arn":true,"attachment_count":true,"id":true,"name_prefix":true,"policy":true,"policy_id":true,"tags":{},"tags_all":{}},"before_sensitive":false,"after_sensitive":{"tags":{},"tags_all":{}}}},{"address":"aws_iam_policy.s3_read_write","mode":"managed","type":"aws_iam_policy","name":"s3_read_write","provider_name":"registry.opentofu.org/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"description":"IAM policy for read/write access to S3 logs backup bucket - dev","name":"s3-logs-backup-read-write-dev","path":"/","tags":{"Environment":"dev","Name":"s3-logs-backup-read-write-dev","Purpose":"LogsAndBackups","Service":"S3Storage"},"tags_all":{"Environment":"dev","ManagedBy":"OpenTofu","Name":"s3-logs-backup-read-write-dev","Project":"S3LogsBackup","Purpose":"LogsAndBackups","Service":"S3Storage"}},"after_unknown":{"arn":true,"attachment_count":true,"id":true,"name_prefix":true,"policy":true,"policy_id":true,"tags":{},"tags_all":{}},"before_sensitive":false,"after_sensitive":{"tags":{},"tags_all":{}}}},{"address":"aws_kms_alias.s3_encryption","mode":"managed","type":"aws_kms_alias","name":"s3_encryption","provider_name":"registry.opentofu.org/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"name":"alias/s3-logs-encryption-key-dev"},"after_unknown":{"arn":true,"id":true,"name_prefix":true,"target_key_arn":true,"target_key_id":true},"before_sensitive":false,"after_sensitive":{}}},{"address":"aws_kms_key.s3_encryption","mode":"managed","type":"aws_kms_key","name":"s3_encryption","provider_name":"registry.opentofu.org/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"bypass_policy_lockout_safety_check":false,"custom_key_store_id":null,"customer_master_key_spec":"SYMMETRIC_DEFAULT","deletion_window_in_days":30,"description":"KMS key for S3 bucket encryption - dev","enable_key_rotation":true,"is_enabled":true,"key_usage":"ENCRYPT_DECRYPT","tags":{"Environment":"dev","Name":"s3-logs-encryption-key-dev","Purpose":"LogsAndBackups","Service":"S3Storage"},"tags_all":{"Environment":"dev","ManagedBy":"OpenTofu","Name":"s3-logs-encryption-key-dev","Project":"S3LogsBackup","Purpose":"LogsAndBackups","Service":"S3Storage"},"timeouts":null,"xks_key_id":null},"after_unknown":{"arn":true,"id":true,"key_id":true,"multi_region":true,"policy":true,"rotation_period_in_days":true,"tags":{},"tags_all":{}},"before_sensitive":false,"after_sensitive":{"tags":{},"tags_all":{}}}},{"address":"aws_kms_key_policy.s3_encryption","mode":"managed","type":"aws_kms_key_policy","name":"s3_encryption","provider_name":"registry.opentofu.org/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"bypass_policy_lockout_safety_check":false,"policy":"{\"Statement\":[{\"Action\":\"kms:*\",\"Effect\":\"Allow\",\"Principal\":{\"AWS\":\"arn:aws:iam::245764575680:root\"},\"Resource\":\"*\",\"Sid\":\"Enable IAM User Permissions\"},{\"Action\":[\"kms:Decrypt\",\"kms:GenerateDataKey\",\"kms:DescribeKey\"],\"Condition\":{\"StringEquals\":{\"kms:ViaService\":\"s3.us-east-1.amazonaws.com\"}},\"Effect\":\"Allow\",\"Principal\":{\"Service\":\"s3.amazonaws.com\"},\"Resource\":\"*\",\"Sid\":\"Allow S3 to use the key\"},{\"Action\":[\"kms:Decrypt\",\"kms:GenerateDataKey\"],\"Effect\":\"Allow\",\"Principal\":{\"Service\":\"cloudwatch.amazonaws.com\"},\"Resource\":\"*\",\"Sid\":\"Allow CloudWatch to use the key\"}],\"Version\":\"2012-10-17\"}"},"after_unknown":{"id":true,"key_id":true},"before_sensitive":false,"after_sensitive":{}}},{"address":"aws_s3_bucket.access_logs","mode":"managed","type":"aws_s3_bucket","name":"access_logs","provider_name":"registry.opentofu.org/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"bucket":"logs-backup-storage-dev-dev-access-logs","force_destroy":false,"tags":{"Environment":"dev","Name":"logs-backup-storage-dev-dev-access-logs","Purpose":"LogsAndBackups","Service":"S3Storage","Type":"AccessLogs"},"tags_all":{"Environment":"dev","ManagedBy":"OpenTofu","Name":"logs-backup-storage-dev-dev-access-logs","Project":"S3LogsBackup","Purpose":"LogsAndBackups","Service":"S3Storage","Type":"AccessLogs"},"timeouts":null},"after_unknown":{"acceleration_status":true,"acl":true,"arn":true,"bucket_domain_name":true,"bucket_prefix":true,"bucket_regional_domain_name":true,"cors_rule":true,"grant":true,"hosted_zone_id":true,"id":true,"lifecycle_rule":true,"logging":true,"object_lock_configuration":true,"object_lock_enabled":true,"policy":true,"region":true,"replication_configuration":true,"request_payer":true,"server_side_encryption_configuration":true,"tags":{},"tags_all":{},"versioning":true,"website":true,"website_domain":true,"website_endpoint":true},"before_sensitive":false,"after_sensitive":{"cors_rule":[],"grant":[],"lifecycle_rule":[],"logging":[],"object_lock_configuration":[],"replication_configuration":[],"server_side_encryption_configuration":[],"tags":{},"tags_all":{},"versioning":[],"website":[]}}},{"address":"aws_s3_bucket.main","mode":"managed","type":"aws_s3_bucket","name":"main","provider_name":"registry.opentofu.org/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"bucket":"logs-backup-storage-dev-dev","force_destroy":false,"tags":{"Environment":"dev","Name":"logs-backup-storage-dev-dev","Purpose":"LogsAndBackups","Service":"S3Storage","Type":"MainStorage"},"tags_all":{"Environment":"dev","ManagedBy":"OpenTofu","Name":"logs-backup-storage-dev-dev","Project":"S3LogsBackup","Purpose":"LogsAndBackups","Service":"S3Storage","Type":"MainStorage"},"timeouts":null},"after_unknown":{"acceleration_status":true,"acl":true,"arn":true,"bucket_domain_name":true,"bucket_prefix":true,"bucket_regional_domain_name":true,"cors_rule":true,"grant":true,"hosted_zone_id":true,"id":true,"lifecycle_rule":true,"logging":true,"object_lock_configuration":true,"object_lock_enabled":true,"policy":true,"region":true,"replication_configuration":true,"request_payer":true,"server_side_encryption_configuration":true,"tags":{},"tags_all":{},"versioning":true,"website":true,"website_domain":true,"website_endpoint":true},"before_sensitive":false,"after_sensitive":{"cors_rule":[],"grant":[],"lifecycle_rule":[],"logging":[],"object_lock_configuration":[],"replication_configuration":[],"server_side_encryption_configuration":[],"tags":{},"tags_all":{},"versioning":[],"website":[]}}},{"address":"aws_s3_bucket_acl.access_logs","mode":"managed","type":"aws_s3_bucket_acl","name":"access_logs","provider_name":"registry.opentofu.org/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"acl":"log-delivery-write","expected_bucket_owner":null},"after_unknown":{"access_control_policy":true,"bucket":true,"id":true},"before_sensitive":false,"after_sensitive":{"access_control_policy":[]}}},{"address":"aws_s3_bucket_lifecycle_configuration.access_logs","mode":"managed","type":"aws_s3_bucket_lifecycle_configuration","name":"access_logs","provider_name":"registry.opentofu.org/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"rule":[{"abort_incomplete_multipart_upload":[],"expiration":[{"date":null,"days":30,"expired_object_delete_marker":false}],"filter":[],"id":"delete-old-access-logs","noncurrent_version_expiration":[],"noncurrent_version_transition":[],"prefix":"","status":"Enabled","transition":[]}],"timeouts":null,"transition_default_minimum_object_size":"all_storage_classes_128K"},"after_unknown":{"bucket":true,"expected_bucket_owner":true,"id":true,"rule":[{"abort_incomplete_multipart_upload":[],"expiration":[{}],"filter":[],"noncurrent_version_expiration":[],"noncurrent_version_transition":[],"transition":[]}]},"before_sensitive":false,"after_sensitive":{"rule":[{"abort_incomplete_multipart_upload":[],"expiration":[{}],"filter":[],"noncurrent_version_expiration":[],"noncurrent_version_transition":[],"transition":[]}]}}},{"address":"aws_s3_bucket_lifecycle_configuration.main","mode":"managed","type":"aws_s3_bucket_lifecycle_configuration","name":"main","provider_name":"registry.opentofu.org/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"rule":[{"abort_incomplete_multipart_upload":[],"expiration":[{"date":null,"days":30,"expired_object_delete_marker":false}],"filter":[],"id":"transition-and-expire-objects","noncurrent_version_expiration":[{"newer_noncurrent_versions":null,"noncurrent_days":30}],"noncurrent_version_transition":[{"newer_noncurrent_versions":null,"noncurrent_days":7,"storage_class":"GLACIER"}],"prefix":"","status":"Enabled","transition":[{"date":null,"days":7,"storage_class":"GLACIER"}]},{"abort_incomplete_multipart_upload":[{"days_after_initiation":7}],"expiration":[],"filter":[],"id":"abort-incomplete-multipart-uploads","noncurrent_version_expiration":[],"noncurrent_version_transition":[],"prefix":"","status":"Enabled","transition":[]}],"timeouts":null,"transition_default_minimum_object_size":"all_storage_classes_128K"},"after_unknown":{"bucket":true,"expected_bucket_owner":true,"id":true,"rule":[{"abort_incomplete_multipart_upload":[],"expiration":[{}],"filter":[],"noncurrent_version_expiration":[{}],"noncurrent_version_transition":[{}],"transition":[{}]},{"abort_incomplete_multipart_upload":[{}],"expiration":[],"filter":[],"noncurrent_version_expiration":[],"noncurrent_version_transition":[],"transition":[]}]},"before_sensitive":false,"after_sensitive":{"rule":[{"abort_incomplete_multipart_upload":[],"expiration":[{}],"filter":[],"noncurrent_version_expiration":[{}],"noncurrent_version_transition":[{}],"transition":[{}]},{"abort_incomplete_multipart_upload":[{}],"expiration":[],"filter":[],"noncurrent_version_expiration":[],"noncurrent_version_transition":[],"transition":[]}]}}},{"address":"aws_s3_bucket_logging.main","mode":"managed","type":"aws_s3_bucket_logging","name":"main","provider_name":"registry.opentofu.org/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"expected_bucket_owner":null,"target_grant":[],"target_object_key_format":[],"target_prefix":"s3-access-logs/"},"after_unknown":{"bucket":true,"id":true,"target_bucket":true,"target_grant":[],"target_object_key_format":[]},"before_sensitive":false,"after_sensitive":{"target_grant":[],"target_object_key_format":[]}}},{"address":"aws_s3_bucket_metric.main","mode":"managed","type":"aws_s3_bucket_metric","name":"main","provider_name":"registry.opentofu.org/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"filter":[],"name":"EntireBucket"},"after_unknown":{"bucket":true,"filter":[],"id":true},"before_sensitive":false,"after_sensitive":{"filter":[]}}},{"address":"aws_s3_bucket_metric.public_prefix","mode":"managed","type":"aws_s3_bucket_metric","name":"public_prefix","provider_name":"registry.opentofu.org/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"filter":[{"access_point":null,"prefix":"public/","tags":null}],"name":"PublicPrefixMetrics"},"after_unknown":{"bucket":true,"filter":[{}],"id":true},"before_sensitive":false,"after_sensitive":{"filter":[{}]}}},{"address":"aws_s3_bucket_ownership_controls.access_logs","mode":"managed","type":"aws_s3_bucket_ownership_controls","name":"access_logs","provider_name":"registry.opentofu.org/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"rule":[{"object_ownership":"BucketOwnerPreferred"}]},"after_unknown":{"bucket":true,"id":true,"rule":[{}]},"before_sensitive":false,"after_sensitive":{"rule":[{}]}}},{"address":"aws_s3_bucket_policy.main","mode":"managed","type":"aws_s3_bucket_policy","name":"main","provider_name":"registry.opentofu.org/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{},"after_unknown":{"bucket":true,"id":true,"policy":true},"before_sensitive":false,"after_sensitive":{}}},{"address":"aws_s3_bucket_public_access_block.access_logs","mode":"managed","type":"aws_s3_bucket_public_access_block","name":"access_logs","provider_name":"registry.opentofu.org/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"block_public_acls":true,"block_public_policy":true,"ignore_public_acls":true,"restrict_public_buckets":true},"after_unknown":{"bucket":true,"id":true},"before_sensitive":false,"after_sensitive":{}}},{"address":"aws_s3_bucket_public_access_block.main","mode":"managed","type":"aws_s3_bucket_public_access_block","name":"main","provider_name":"registry.opentofu.org/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"block_public_acls":true,"block_public_policy":false,"ignore_public_acls":true,"restrict_public_buckets":false},"after_unknown":{"bucket":true,"id":true},"before_sensitive":false,"after_sensitive":{}}},{"address":"aws_s3_bucket_server_side_encryption_configuration.access_logs","mode":"managed","type":"aws_s3_bucket_server_side_encryption_configuration","name":"access_logs","provider_name":"registry.opentofu.org/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"expected_bucket_owner":null,"rule":[{"apply_server_side_encryption_by_default":[{"kms_master_key_id":"","sse_algorithm":"AES256"}],"bucket_key_enabled":null}]},"after_unknown":{"bucket":true,"id":true,"rule":[{"apply_server_side_encryption_by_default":[{}]}]},"before_sensitive":false,"after_sensitive":{"rule":[{"apply_server_side_encryption_by_default":[{}]}]}}},{"address":"aws_s3_bucket_server_side_encryption_configuration.main","mode":"managed","type":"aws_s3_bucket_server_side_encryption_configuration","name":"main","provider_name":"registry.opentofu.org/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"expected_bucket_owner":null,"rule":[{"apply_server_side_encryption_by_default":[{"sse_algorithm":"aws:kms"}],"bucket_key_enabled":true}]},"after_unknown":{"bucket":true,"id":true,"rule":[{"apply_server_side_encryption_by_default":[{"kms_master_key_id":true}]}]},"before_sensitive":false,"after_sensitive":{"rule":[{"apply_server_side_encryption_by_default":[{}]}]}}},{"address":"aws_s3_bucket_versioning.main","mode":"managed","type":"aws_s3_bucket_versioning","name":"main","provider_name":"registry.opentofu.org/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"expected_bucket_owner":null,"mfa":null,"versioning_configuration":[{"status":"Enabled"}]},"after_unknown":{"bucket":true,"id":true,"versioning_configuration":[{"mfa_delete":true}]},"before_sensitive":false,"after_sensitive":{"versioning_configuration":[{}]}}},{"address":"aws_sns_topic.s3_alerts","mode":"managed","type":"aws_sns_topic","name":"s3_alerts","provider_name":"registry.opentofu.org/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"application_failure_feedback_role_arn":null,"application_success_feedback_role_arn":null,"application_success_feedback_sample_rate":null,"archive_policy":null,"content_based_deduplication":false,"delivery_policy":null,"display_name":"S3 Logs Backup Alerts - dev","fifo_topic":false,"firehose_failure_feedback_role_arn":null,"firehose_success_feedback_role_arn":null,"firehose_success_feedback_sample_rate":null,"http_failure_feedback_role_arn":null,"http_success_feedback_role_arn":null,"http_success_feedback_sample_rate":null,"lambda_failure_feedback_role_arn":null,"lambda_success_feedback_role_arn":null,"lambda_success_feedback_sample_rate":null,"name":"s3-logs-backup-alerts-dev","sqs_failure_feedback_role_arn":null,"sqs_success_feedback_role_arn":null,"sqs_success_feedback_sample_rate":null,"tags":{"Environment":"dev","Name":"s3-logs-backup-alerts-dev","Purpose":"LogsAndBackups","Service":"S3Storage"},"tags_all":{"Environment":"dev","ManagedBy":"OpenTofu","Name":"s3-logs-backup-alerts-dev","Project":"S3LogsBackup","Purpose":"LogsAndBackups","Service":"S3Storage"}},"after_unknown":{"arn":true,"beginning_archive_time":true,"fifo_throughput_scope":true,"id":true,"kms_master_key_id":true,"name_prefix":true,"owner":true,"policy":true,"signature_version":true,"tags":{},"tags_all":{},"tracing_config":true},"before_sensitive":false,"after_sensitive":{"tags":{},"tags_all":{}}}}],"output_changes":{"access_logs_bucket_arn":{"actions":["create"],"before":null,"after_unknown":true,"before_sensitive":false,"after_sensitive":false},"access_logs_bucket_id":{"actions":["create"],"before":null,"after_unknown":true,"before_sensitive":false,"after_sensitive":false},"cloudwatch_dashboard_name":{"actions":["create"],"before":null,"after":"s3-logs-backup-dev","after_unknown":false,"before_sensitive":false,"after_sensitive":false},"iam_policy_read_only_arn":{"actions":["create"],"before":null,"after_unknown":true,"before_sensitive":false,"after_sensitive":false},"iam_policy_read_write_arn":{"actions":["create"],"before":null,"after_unknown":true,"before_sensitive":false,"after_sensitive":false},"kms_key_alias":{"actions":["create"],"before":null,"after":"alias/s3-logs-encryption-key-dev","after_unknown":false,"before_sensitive":false,"after_sensitive":false},"kms_key_arn":{"actions":["create"],"before":null,"after_unknown":true,"before_sensitive":false,"after_sensitive":false},"kms_key_id":{"actions":["create"],"before":null,"after_unknown":true,"before_sensitive":false,"after_sensitive":false},"main_bucket_arn":{"actions":["create"],"before":null,"after_unknown":true,"before_sensitive":false,"after_sensitive":false},"main_bucket_domain_name":{"actions":["create"],"before":null,"after_unknown":true,"before_sensitive":false,"after_sensitive":false},"main_bucket_id":{"actions":["create"],"before":null,"after_unknown":true,"before_sensitive":false,"after_sensitive":false},"main_bucket_regional_domain_name":{"actions":["create"],"before":null,"after_unknown":true,"before_sensitive":false,"after_sensitive":false},"sns_topic_arn":{"actions":["create"],"before":null,"after_unknown":true,"before_sensitive":false,"after_sensitive":false}},"prior_state":{"format_version":"1.0","terraform_version":"1.10.7","values":{"outputs":{"cloudwatch_dashboard_name":{"sensitive":false,"value":"s3-logs-backup-dev","type":"string"},"kms_key_alias":{"sensitive":false,"value":"alias/s3-logs-encryption-key-dev","type":"string"}},"root_module":{"resources":[{"address":"data.aws_caller_identity.current","mode":"data","type":"aws_caller_identity","name":"current","provider_name":"registry.opentofu.org/hashicorp/aws","schema_version":0,"values":{"account_id":"245764575680","arn":"arn:aws:iam::245764575680:user/metronet_spark","id":"245764575680","user_id":"AIDATSOFV2HAJKESNMLEL"},"sensitive_values":{}},{"address":"data.aws_partition.current","mode":"data","type":"aws_partition","name":"current","provider_name":"registry.opentofu.org/hashicorp/aws","schema_version":0,"values":{"dns_suffix":"amazonaws.com","id":"aws","partition":"aws","reverse_dns_prefix":"com.amazonaws"},"sensitive_values":{}}]}}},"configuration":{"provider_config":{"aws":{"name":"aws","full_name":"registry.opentofu.org/hashicorp/aws","version_constraint":"~\u003e 5.0","expressions":{"default_tags":[{"tags":{"references":["var.environment"]}}],"region":{"references":["var.aws_region"]}}}},"root_module":{"outputs":{"access_logs_bucket_arn":{"expression":{"references":["aws_s3_bucket.access_logs.arn","aws_s3_bucket.access_logs"]},"description":"The ARN of the access logs S3 bucket"},"access_logs_bucket_id":{"expression":{"references":["aws_s3_bucket.access_logs.id","aws_s3_bucket.access_logs"]},"description":"The ID of the access logs S3 bucket"},"cloudwatch_dashboard_name":{"expression":{"references":["aws_cloudwatch_dashboard.s3_monitoring.dashboard_name","aws_cloudwatch_dashboard.s3_monitoring"]},"description":"The name of the CloudWatch dashboard for S3 monitoring"},"iam_policy_read_only_arn":{"expression":{"references":["aws_iam_policy.s3_read_only.arn","aws_iam_policy.s3_read_only"]},"description":"The ARN of the IAM policy for S3 read-only access"},"iam_policy_read_write_arn":{"expression":{"references":["aws_iam_policy.s3_read_write.arn","aws_iam_policy.s3_read_write"]},"description":"The ARN of the IAM policy for S3 read/write access"},"kms_key_alias":{"expression":{"references":["aws_kms_alias.s3_encryption.name","aws_kms_alias.s3_encryption"]},"description":"The alias of the KMS key used for S3 encryption"},"kms_key_arn":{"expression":{"references":["aws_kms_key.s3_encryption.arn","aws_kms_key.s3_encryption"]},"description":"The ARN of the KMS key used for S3 encryption"},"kms_key_id":{"expression":{"references":["aws_kms_key.s3_encryption.id","aws_kms_key.s3_encryption"]},"description":"The ID of the KMS key used for S3 encryption"},"main_bucket_arn":{"expression":{"references":["aws_s3_bucket.main.arn","aws_s3_bucket.main"]},"description":"The ARN of the main S3 bucket"},"main_bucket_domain_name":{"expression":{"references":["aws_s3_bucket.main.bucket_domain_name","aws_s3_bucket.main"]},"description":"The domain name of the main S3 bucket"},"main_bucket_id":{"expression":{"references":["aws_s3_bucket.main.id","aws_s3_bucket.main"]},"description":"The ID of the main S3 bucket"},"main_bucket_regional_domain_name":{"expression":{"references":["aws_s3_bucket.main.bucket_regional_domain_name","aws_s3_bucket.main"]},"description":"The regional domain name of the main S3 bucket"},"sns_topic_arn":{"expression":{"references":["aws_sns_topic.s3_alerts.arn","aws_sns_topic.s3_alerts"]},"description":"The ARN of the SNS topic for S3 alerts"}},"resources":[{"address":"aws_cloudwatch_dashboard.s3_monitoring","mode":"managed","type":"aws_cloudwatch_dashboard","name":"s3_monitoring","provider_config_key":"aws","expressions":{"dashboard_body":{"references":["var.aws_region","var.aws_region","var.aws_region","var.aws_region"]},"dashboard_name":{"references":["var.environment"]}},"schema_version":0},{"address":"aws_cloudwatch_metric_alarm.bucket_4xx_errors","mode":"managed","type":"aws_cloudwatch_metric_alarm","name":"bucket_4xx_errors","provider_config_key":"aws","expressions":{"alarm_actions":{"references":["aws_sns_topic.s3_alerts.arn","aws_sns_topic.s3_alerts"]},"alarm_description":{"constant_value":"Alert when S3 bucket 4xx errors exceed threshold"},"alarm_name":{"references":["local.bucket_name"]},"comparison_operator":{"constant_value":"GreaterThanThreshold"},"dimensions":{"references":["aws_s3_bucket.main.id","aws_s3_bucket.main"]},"evaluation_periods":{"constant_value":2},"metric_name":{"constant_value":"4xxErrors"},"namespace":{"constant_value":"AWS/S3"},"period":{"constant_value":300},"statistic":{"constant_value":"Sum"},"tags":{"references":["local.common_tags","local.bucket_name"]},"threshold":{"constant_value":10},"treat_missing_data":{"constant_value":"notBreaching"}},"schema_version":1},{"address":"aws_cloudwatch_metric_alarm.bucket_5xx_errors","mode":"managed","type":"aws_cloudwatch_metric_alarm","name":"bucket_5xx_errors","provider_config_key":"aws","expressions":{"alarm_actions":{"references":["aws_sns_topic.s3_alerts.arn","aws_sns_topic.s3_alerts"]},"alarm_description":{"constant_value":"Alert when S3 bucket 5xx errors exceed threshold"},"alarm_name":{"references":["local.bucket_name"]},"comparison_operator":{"constant_value":"GreaterThanThreshold"},"dimensions":{"references":["aws_s3_bucket.main.id","aws_s3_bucket.main"]},"evaluation_periods":{"constant_value":1},"metric_name":{"constant_value":"5xxErrors"},"namespace":{"constant_value":"AWS/S3"},"period":{"constant_value":300},"statistic":{"constant_value":"Sum"},"tags":{"references":["local.common_tags","local.bucket_name"]},"threshold":{"constant_value":5},"treat_missing_data":{"constant_value":"notBreaching"}},"schema_version":1},{"address":"aws_cloudwatch_metric_alarm.bucket_size","mode":"managed","type":"aws_cloudwatch_metric_alarm","name":"bucket_size","provider_config_key":"aws","expressions":{"alarm_actions":{"references":["aws_sns_topic.s3_alerts.arn","aws_sns_topic.s3_alerts"]},"alarm_description":{"constant_value":"Alert when S3 bucket size exceeds 100GB"},"alarm_name":{"references":["local.bucket_name"]},"comparison_operator":{"constant_value":"GreaterThanThreshold"},"dimensions":{"references":["aws_s3_bucket.main.id","aws_s3_bucket.main"]},"evaluation_periods":{"constant_value":1},"metric_name":{"constant_value":"BucketSizeBytes"},"namespace":{"constant_value":"AWS/S3"},"period":{"constant_value":86400},"statistic":{"constant_value":"Average"},"tags":{"references":["local.common_tags","local.bucket_name"]},"threshold":{"constant_value":107374182400},"treat_missing_data":{"constant_value":"notBreaching"}},"schema_version":1},{"address":"aws_cloudwatch_metric_alarm.number_of_objects","mode":"managed","type":"aws_cloudwatch_metric_alarm","name":"number_of_objects","provider_config_key":"aws","expressions":{"alarm_actions":{"references":["aws_sns_topic.s3_alerts.arn","aws_sns_topic.s3_alerts"]},"alarm_description":{"constant_value":"Alert when S3 bucket object count exceeds 100,000"},"alarm_name":{"references":["local.bucket_name"]},"comparison_operator":{"constant_value":"GreaterThanThreshold"},"dimensions":{"references":["aws_s3_bucket.main.id","aws_s3_bucket.main"]},"evaluation_periods":{"constant_value":1},"metric_name":{"constant_value":"NumberOfObjects"},"namespace":{"constant_value":"AWS/S3"},"period":{"constant_value":86400},"statistic":{"constant_value":"Average"},"tags":{"references":["local.common_tags","local.bucket_name"]},"threshold":{"constant_value":100000},"treat_missing_data":{"constant_value":"notBreaching"}},"schema_version":1},{"address":"aws_iam_policy.s3_read_only","mode":"managed","type":"aws_iam_policy","name":"s3_read_only","provider_config_key":"aws","expressions":{"description":{"references":["var.environment"]},"name":{"references":["var.environment"]},"path":{"constant_value":"/"},"policy":{"references":["aws_s3_bucket.main.arn","aws_s3_bucket.main","aws_s3_bucket.main.arn","aws_s3_bucket.main","aws_kms_key.s3_encryption.arn","aws_kms_key.s3_encryption"]},"tags":{"references":["local.common_tags","var.environment"]}},"schema_version":0},{"address":"aws_iam_policy.s3_read_write","mode":"managed","type":"aws_iam_policy","name":"s3_read_write","provider_config_key":"aws","expressions":{"description":{"references":["var.environment"]},"name":{"references":["var.environment"]},"path":{"constant_value":"/"},"policy":{"references":["aws_s3_bucket.main.arn","aws_s3_bucket.main","aws_s3_bucket.main.arn","aws_s3_bucket.main","aws_kms_key.s3_encryption.arn","aws_kms_key.s3_encryption"]},"tags":{"references":["local.common_tags","var.environment"]}},"schema_version":0},{"address":"aws_kms_alias.s3_encryption","mode":"managed","type":"aws_kms_alias","name":"s3_encryption","provider_config_key":"aws","expressions":{"name":{"references":["local.kms_key_alias"]},"target_key_id":{"references":["aws_kms_key.s3_encryption.key_id","aws_kms_key.s3_encryption"]}},"schema_version":0},{"address":"aws_kms_key.s3_encryption","mode":"managed","type":"aws_kms_key","name":"s3_encryption","provider_config_key":"aws","expressions":{"deletion_window_in_days":{"constant_value":30},"description":{"references":["var.environment"]},"enable_key_rotation":{"constant_value":true},"tags":{"references":["local.common_tags","var.environment"]}},"schema_version":0},{"address":"aws_kms_key_policy.s3_encryption","mode":"managed","type":"aws_kms_key_policy","name":"s3_encryption","provider_config_key":"aws","expressions":{"key_id":{"references":["aws_kms_key.s3_encryption.id","aws_kms_key.s3_encryption"]},"policy":{"references":["data.aws_partition.current.partition","data.aws_partition.current","data.aws_caller_identity.current.account_id","data.aws_caller_identity.current","var.aws_region"]}},"schema_version":0},{"address":"aws_s3_bucket.access_logs","mode":"managed","type":"aws_s3_bucket","name":"access_logs","provider_config_key":"aws","expressions":{"bucket":{"references":["local.access_logs_bucket_name"]},"tags":{"references":["local.common_tags","local.access_logs_bucket_name"]}},"schema_version":0},{"address":"aws_s3_bucket.main","mode":"managed","type":"aws_s3_bucket","name":"main","provider_config_key":"aws","expressions":{"bucket":{"references":["local.bucket_name"]},"tags":{"references":["local.common_tags","local.bucket_name"]}},"schema_version":0},{"address":"aws_s3_bucket_acl.access_logs","mode":"managed","type":"aws_s3_bucket_acl","name":"access_logs","provider_config_key":"aws","expressions":{"acl":{"constant_value":"log-delivery-write"},"bucket":{"references":["aws_s3_bucket.access_logs.id","aws_s3_bucket.access_logs"]}},"schema_version":0,"depends_on":["aws_s3_bucket_ownership_controls.access_logs"]},{"address":"aws_s3_bucket_lifecycle_configuration.access_logs","mode":"managed","type":"aws_s3_bucket_lifecycle_configuration","name":"access_logs","provider_config_key":"aws","expressions":{"bucket":{"references":["aws_s3_bucket.access_logs.id","aws_s3_bucket.access_logs"]},"rule":[{"expiration":[{"days":{"references":["var.lifecycle_expiration_days"]}}],"id":{"constant_value":"delete-old-access-logs"},"status":{"constant_value":"Enabled"}}]},"schema_version":1},{"address":"aws_s3_bucket_lifecycle_configuration.main","mode":"managed","type":"aws_s3_bucket_lifecycle_configuration","name":"main","provider_config_key":"aws","expressions":{"bucket":{"references":["aws_s3_bucket.main.id","aws_s3_bucket.main"]},"rule":[{"expiration":[{"days":{"references":["var.lifecycle_expiration_days"]}}],"id":{"constant_value":"transition-and-expire-objects"},"noncurrent_version_expiration":[{"noncurrent_days":{"references":["var.lifecycle_expiration_days"]}}],"noncurrent_version_transition":[{"noncurrent_days":{"references":["var.lifecycle_transition_days"]},"storage_class":{"constant_value":"GLACIER"}}],"status":{"constant_value":"Enabled"},"transition":[{"days":{"references":["var.lifecycle_transition_days"]},"storage_class":{"constant_value":"GLACIER"}}]},{"abort_incomplete_multipart_upload":[{"days_after_initiation":{"constant_value":7}}],"id":{"constant_value":"abort-incomplete-multipart-uploads"},"status":{"constant_value":"Enabled"}}]},"schema_version":1},{"address":"aws_s3_bucket_logging.main","mode":"managed","type":"aws_s3_bucket_logging","name":"main","provider_config_key":"aws","expressions":{"bucket":{"references":["aws_s3_bucket.main.id","aws_s3_bucket.main"]},"target_bucket":{"references":["aws_s3_bucket.access_logs.id","aws_s3_bucket.access_logs"]},"target_prefix":{"constant_value":"s3-access-logs/"}},"schema_version":0},{"address":"aws_s3_bucket_metric.main","mode":"managed","type":"aws_s3_bucket_metric","name":"main","provider_config_key":"aws","expressions":{"bucket":{"references":["aws_s3_bucket.main.id","aws_s3_bucket.main"]},"name":{"constant_value":"EntireBucket"}},"schema_version":0},{"address":"aws_s3_bucket_metric.public_prefix","mode":"managed","type":"aws_s3_bucket_metric","name":"public_prefix","provider_config_key":"aws","expressions":{"bucket":{"references":["aws_s3_bucket.main.id","aws_s3_bucket.main"]},"filter":[{"prefix":{"references":["var.public_access_prefix"]}}],"name":{"constant_value":"PublicPrefixMetrics"}},"schema_version":0},{"address":"aws_s3_bucket_ownership_controls.access_logs","mode":"managed","type":"aws_s3_bucket_ownership_controls","name":"access_logs","provider_config_key":"aws","expressions":{"bucket":{"references":["aws_s3_bucket.access_logs.id","aws_s3_bucket.access_logs"]},"rule":[{"object_ownership":{"constant_value":"BucketOwnerPreferred"}}]},"schema_version":0},{"address":"aws_s3_bucket_policy.main","mode":"managed","type":"aws_s3_bucket_policy","name":"main","provider_config_key":"aws","expressions":{"bucket":{"references":["aws_s3_bucket.main.id","aws_s3_bucket.main"]},"policy":{"references":["aws_s3_bucket.main.arn","aws_s3_bucket.main","aws_s3_bucket.main.arn","aws_s3_bucket.main","aws_s3_bucket.main.arn","aws_s3_bucket.main","var.public_access_prefix","aws_s3_bucket.main.arn","aws_s3_bucket.main"]}},"schema_version":0},{"address":"aws_s3_bucket_public_access_block.access_logs","mode":"managed","type":"aws_s3_bucket_public_access_block","name":"access_logs","provider_config_key":"aws","expressions":{"block_public_acls":{"constant_value":true},"block_public_policy":{"constant_value":true},"bucket":{"references":["aws_s3_bucket.access_logs.id","aws_s3_bucket.access_logs"]},"ignore_public_acls":{"constant_value":true},"restrict_public_buckets":{"constant_value":true}},"schema_version":0},{"address":"aws_s3_bucket_public_access_block.main","mode":"managed","type":"aws_s3_bucket_public_access_block","name":"main","provider_config_key":"aws","expressions":{"block_public_acls":{"constant_value":true},"block_public_policy":{"constant_value":false},"bucket":{"references":["aws_s3_bucket.main.id","aws_s3_bucket.main"]},"ignore_public_acls":{"constant_value":true},"restrict_public_buckets":{"constant_value":false}},"schema_version":0},{"address":"aws_s3_bucket_server_side_encryption_configuration.access_logs","mode":"managed","type":"aws_s3_bucket_server_side_encryption_configuration","name":"access_logs","provider_config_key":"aws","expressions":{"bucket":{"references":["aws_s3_bucket.access_logs.id","aws_s3_bucket.access_logs"]},"rule":[{"apply_server_side_encryption_by_default":[{"sse_algorithm":{"constant_value":"AES256"}}]}]},"schema_version":0},{"address":"aws_s3_bucket_server_side_encryption_configuration.main","mode":"managed","type":"aws_s3_bucket_server_side_encryption_configuration","name":"main","provider_config_key":"aws","expressions":{"bucket":{"references":["aws_s3_bucket.main.id","aws_s3_bucket.main"]},"rule":[{"apply_server_side_encryption_by_default":[{"kms_master_key_id":{"references":["aws_kms_key.s3_encryption.arn","aws_kms_key.s3_encryption"]},"sse_algorithm":{"constant_value":"aws:kms"}}],"bucket_key_enabled":{"constant_value":true}}]},"schema_version":0},{"address":"aws_s3_bucket_versioning.main","mode":"managed","type":"aws_s3_bucket_versioning","name":"main","provider_config_key":"aws","expressions":{"bucket":{"references":["aws_s3_bucket.main.id","aws_s3_bucket.main"]},"versioning_configuration":[{"status":{"references":["var.enable_versioning"]}}]},"schema_version":0},{"address":"aws_sns_topic.s3_alerts","mode":"managed","type":"aws_sns_topic","name":"s3_alerts","provider_config_key":"aws","expressions":{"display_name":{"references":["var.environment"]},"kms_master_key_id":{"references":["aws_kms_key.s3_encryption.id","aws_kms_key.s3_encryption"]},"name":{"references":["var.environment"]},"tags":{"references":["local.common_tags","var.environment"]}},"schema_version":0},{"address":"data.aws_caller_identity.current","mode":"data","type":"aws_caller_identity","name":"current","provider_config_key":"aws","schema_version":0},{"address":"data.aws_partition.current","mode":"data","type":"aws_partition","name":"current","provider_config_key":"aws","schema_version":0}],"variables":{"LOG":{"description":"Log level for debugging and monitoring"},"aws_region":{"description":"AWS region where resources will be created"},"enable_versioning":{"description":"Enable versioning on the main S3 bucket"},"environment":{"description":"Environment name for resource naming and tagging"},"kms_key_alias":{"description":"Alias for the KMS key used for S3 bucket encryption"},"lifecycle_expiration_days":{"description":"Number of days before permanently deleting objects"},"lifecycle_transition_days":{"description":"Number of days before transitioning objects to GLACIER storage class"},"public_access_prefix":{"description":"S3 prefix that allows public read access"},"s3_bucket_name":{"description":"Name of the main S3 bucket for logs and backups"}}}},"relevant_attributes":[{"resource":"aws_cloudwatch_dashboard.s3_monitoring","attribute":["dashboard_name"]},{"resource":"aws_iam_policy.s3_read_only","attribute":["arn"]},{"resource":"aws_iam_policy.s3_read_write","attribute":["arn"]},{"resource":"aws_kms_alias.s3_encryption","attribute":["name"]},{"resource":"aws_kms_key.s3_encryption","attribute":["arn"]},{"resource":"aws_kms_key.s3_encryption","attribute":["key_id"]},{"resource":"aws_kms_key.s3_encryption","attribute":["id"]},{"resource":"aws_s3_bucket.access_logs","attribute":["arn"]},{"resource":"aws_s3_bucket.access_logs","attribute":["id"]},{"resource":"aws_s3_bucket.main","attribute":["arn"]},{"resource":"aws_s3_bucket.main","attribute":["bucket_regional_domain_name"]},{"resource":"aws_s3_bucket.main","attribute":["id"]},{"resource":"aws_s3_bucket.main","attribute":["bucket_domain_name"]},{"resource":"aws_sns_topic.s3_alerts","attribute":["arn"]},{"resource":"data.aws_caller_identity.current","attribute":["account_id"]},{"resource":"data.aws_partition.current","attribute":["partition"]}],"timestamp":"2025-12-04T22:05:37Z","errored":false}
